const CCInspectorPluginMsg=require("CCInspectorPluginMsg");let inspector={log(){1===arguments.length||2===arguments.length||arguments.length},initInspector(){window.inspectorGameMemoryStorage=window.inspectorGameMemoryStorage||{},this.onWebSocketInit()},_collectNodeInfo(e){if(e){let t=this._getNodeComponentsInfo(e);return{name:e.name,active:e.active,uuid:e.uuid,type:e.constructor.name,x:e.x,y:e.y,zIndex:e.zIndex,childrenCount:e.childrenCount,children:[],width:e.width,height:e.height,color:{r:e.color.r,g:e.color.g,b:e.color.b,a:e.color.a},opacity:e.opacity,rotation:e.rotation,rotationX:e.rotationX,rotationY:e.rotationY,anchorX:e.anchorX,anchorY:e.anchorY,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,components:t}}return null},getNodeInfo(e){let t=window.inspectorGameMemoryStorage[e];return t?this._collectNodeInfo(t):null},_getNodeComponentsInfo(e){let t=[],o=e._components;for(let e=0;e<o.length;e++){let n=o[e];window.inspectorGameMemoryStorage[n.uuid]=n,t.push({uuid:n.uuid,type:n.constructor.name,name:cc.js.getClassName(n)})}return t},_collectChildrenInfo(e,t){let o=this._collectNodeInfo(e);window.inspectorGameMemoryStorage[e.uuid]=e;let n=e.getChildren();for(let e=0;e<n.length;e++){let t=n[e];this._collectChildrenInfo(t,o.children)}t.push(o)},_collectTreeInfo(){let e=[],t=cc.director.getScene().getChildren();for(let o=0;o<t.length;o++){let n=t[o];this._collectChildrenInfo(n,e)}return e},wsSend(e,t){if(this.ws){let o={code:e,data:t},n=JSON.stringify(o);cc.sys.isBrowser,this.ws.send(n)}},onWebSocketInit(){this.ws=new WebSocket("ws://localhost:6543"),this.ws.onopen=function(){this.wsSend(CCInspectorPluginMsg.Msg.Test,"hello cc-inspector!")}.bind(this),this.ws.onmessage=function(e){cc.sys.isBrowser;let t=JSON.parse(e.data),o=t.code,n=t.data;if(o===CCInspectorPluginMsg.Msg.GetTreeInfo){let e=this._collectTreeInfo();this.wsSend(CCInspectorPluginMsg.Msg.GetTreeInfo,e)}else if(o===CCInspectorPluginMsg.Msg.GetNodeInfo){let e=this.getNodeInfo(n);e&&this.wsSend(CCInspectorPluginMsg.Msg.GetNodeInfo,e)}else if(o===CCInspectorPluginMsg.Msg.Position){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.x=t.x,o.y=t.y)}else if(o===CCInspectorPluginMsg.Msg.Opacity){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.opacity=t)}else if(o===CCInspectorPluginMsg.Msg.Anchor){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.anchorX=t.x,o.anchorY=t.y)}else if(o===CCInspectorPluginMsg.Msg.Size){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.width=t.width,o.height=t.height)}else if(o===CCInspectorPluginMsg.Msg.Scale){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.scaleX=t.x,o.scaleY=t.y)}else if(o===CCInspectorPluginMsg.Msg.Rotation){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.rotation=t)}else if(o===CCInspectorPluginMsg.Msg.Skew){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.skewX=t.x,o.skewY=t.y)}else if(o===CCInspectorPluginMsg.Msg.Color){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.color=cc.color(t))}else if(o===CCInspectorPluginMsg.Msg.Active){let e=n.uuid,t=n.data,o=window.inspectorGameMemoryStorage[e];o&&(o.active=t)}}.bind(this),this.ws.onerror=function(){this.ws=null}.bind(this),this.ws.onclose=function(){this.ws=null}.bind(this)},_testHttp(){let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&e.status>=200&&e.status<400)e.responseText}.bind(this),e.onerror=function(){},e.open("post","http://localhost:6543",!0);try{e.send("test")}catch(e){}},test(){if(CC_EDITOR){Editor.log("initInspector in editor");const{ipcRenderer:e}=require("electron");e.on("msg1",function(){Editor.log("收到msg1的消息")}),e.on("ipc-message",function(){Editor.log("ipc-message")})}}};inspector.initInspector(),module.exports=inspector;